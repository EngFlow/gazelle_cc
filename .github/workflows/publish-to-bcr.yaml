# Publishes to the Bazel Central Registry.
#
# Based on .github/workflows/publish-to-bcr.yml from bazel-contrib/rules_scala v7.0.0.
# See .bcr/README.md.
name: Publish to the Bazel Central Registry

on:
  # Run from release.yml.
  workflow_call:
    inputs:
      tag_name:
        required: true
        type: string
    secrets:
      ENGFLOW_AUTOMATION_PUBLIC_PAT:
        required: true

  # In case of problems, enable manual dispatch from the GitHub UI.
  workflow_dispatch:
    inputs:
      tag_name:
        required: true
        type: string

jobs:
  publish-to-bcr:
    uses: "bazel-contrib/publish-to-bcr/.github/workflows/publish.yaml@1a42c3dca6566cf3a07689768259f1a35066ed01"
    with:
      tag_name: "${{ inputs.tag_name }}"
      registry_fork: "EngFlow/bazel-central-registry"
      draft: false
      # Use `@engflow-automation-public` as public-facing identity in pushes to
      # BCR via `.github/workflows/publish-to-bcr.yaml`.
      author_name: "EngFlow Inc."
      author_email: "engflow-github-automation+public@engflow.com"
    permissions:
      attestations: write
      contents: write
      id-token: write
    secrets:
      publish_token: "${{ secrets.ENGFLOW_AUTOMATION_PUBLIC_PAT }}"
